---
title: 前端缓存
pageInfo: false
date: 2023-05-03
category:
  - 前端
tag:
  - JavaScript
---

## 浏览器缓存

浏览器缓存主要有强制缓存和协商缓存两种。

浏览器要不要缓存取决于 HTTP 响应头有没有设置 Cache-Control 且取值不为 no-store（no-store 表示不缓存）。

当一个浏览器第一次访问一个网站的时候，向该网站的服务器发送请求。如果服务端觉得浏览器请求的资源应该被缓存下来时，比如图片，CSS 文件等不常更改的资源，就会在 HTTP 响应里面添加一个响应头 Cache-Control：max-age=1200（即缓存有效时间为 1200s）。这会让浏览器自动将该请求的资源缓存到本地。

下一次请求该资源时，浏览器先看本地缓存的资源有没有过期，没过期的话直接使用该资源，不发送请求，且返回 Status Code:200 OK，但是会添加上（from memory cache 或 from disk memory）的标识，表示该文件是从缓存中拿到的，没有向服务端发送请求。

如果过期了且没有协商缓存就向服务端发送请求索要该资源，服务端依然是根据该资源的特性判断要不要缓存，即要不要加 Cache-Control 响应头。

### 强缓存

强制缓存，我们简称强缓存。强缓存不发送请求，直接从本地缓存读取资源并返回 Status Code: 200 OK。from memory cache 表示资源是从内存当中获取的，浏览器关闭后该资源内存会被释放；from disk memory 表示资源是从硬盘中读取的，关掉浏览器资源依然在。

### 协商缓存

当一个浏览器第一次访问一个网站的时候，向该网站的服务器发送请求。服务器返回资源和资源的标识。浏览器会把该资源和该标识缓存到本地。
下一次请求该资源时，浏览器会把该资源标识带上，服务器就会对该标识对应的资源进行判断：
（1）如果该资源发生了修改，已不是原来的版本，那么服务器就会返回最新的资源和新的资源标识，状态码为 200，表示请求成功。
（2）如果该资源距离上一次请求并没有发生改变，则返回 304，告诉浏览器可以直接使用本地缓存的资源，响应时就无需携带资源。

## 本地缓存

localStorage 适合持久化缓存数据，比如页面的默认偏好配置等；sessionStorage 适合一次性临时数据保存。

| 分类           | 生命周期                                                                   | 存储容量                       | 存储位置                                   |
| -------------- | -------------------------------------------------------------------------- | ------------------------------ | ------------------------------------------ |
| cookie         | 默认保存在内存中，随浏览器关闭失效（如果设置过期时间，在到过期时间后失效） | 4KB                            | 保存在客户端，每次请求时都会带上           |
| localStorage   | 仅在当前网页会话下有效，关闭页面或浏览器后会被清除。                       | 5MB 左右（不同浏览器情况不同） | 保存在客户端，不与服务端交互。节省网络流量 |
| sessionStorage | 默认保存在内存中，随浏览器关闭失效（如果设置过期时间，在到过期时间后失效） | 5MB 左右（不同浏览器情况不同） | 保存在客户端，不与服务端交互。节省网络流量 |
